<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DutyCycle Studio | _VIFEXTech</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- xterm.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1><a href="https://github.com/FASTSHIFT/DutyCycle" target="_blank" class="glow"
                    style="text-decoration:none;">DutyCycle</a> Studio</h1>
            <p class="author">Crafted with ‚ö° by <a href="https://github.com/FASTSHIFT" target="_blank">_VIFEXTech</a>
            </p>
        </div>
        <div class="grid">
            <!-- Connection Card -->
            <div class="card">
                <h2>üîå ËøûÊé•ËÆæÁΩÆ</h2>
                <div class="row">
                    <label style="display:flex;align-items:center;gap:8px;cursor:default;font-size:12px;flex:1">
                        <span style="opacity:0.85;min-width:56px;">‰∏≤Âè£: </span>
                        <select id="portSelect" aria-label="‰∏≤Âè£ÈÄâÊã©" title="ÈÄâÊã©Ë¶ÅËøûÊé•ÁöÑ‰∏≤Âè£">
                            <option value="">ÈÄâÊã©‰∏≤Âè£...</option>
                        </select>
                    </label>
                    <button onclick="refreshPorts()">Âà∑Êñ∞</button>
                </div>
                <div class="row">
                    <label style="display:flex;align-items:center;gap:8px;cursor:default;font-size:12px;">
                        <span style="opacity:0.85;min-width:56px;">Ê≥¢ÁâπÁéá: </span>
                        <input type="number" id="baudrate" value="115200" placeholder="Ê≥¢ÁâπÁéá" aria-label="Ê≥¢ÁâπÁéá"
                            title="ËæìÂÖ•‰∏≤Âè£Ê≥¢ÁâπÁéáÔºå‰æãÂ¶Ç 115200">
                    </label>
                    <button id="connectBtn" onclick="toggleConnect()" aria-label="ËøûÊé•/Êñ≠ÂºÄ"
                        title="ËøûÊé•ÊàñÊñ≠ÂºÄÂΩìÂâçÈÄâÊã©ÁöÑ‰∏≤Âè£">ËøûÊé•</button>
                </div>
                <div class="row">
                    <span>Áä∂ÊÄÅ: </span>
                    <span id="connectionStatus" class="status disconnected">Êú™ËøûÊé•</span>
                </div>
            </div>

            <!-- Clock Card -->
            <div class="card">
                <h2>üïê Êó∂ÈíüËÆæÁΩÆ</h2>
                <div class="row">
                    <button onclick="syncClock()" class="success" style="flex:1">ÂêåÊ≠•Êó∂Èó¥</button>
                    <label style="display:flex;align-items:center;gap:4px;cursor:pointer;font-size:12px;">
                        <input type="checkbox" id="autoSyncClock" style="width:auto;" onchange="onAutoSyncChange()">
                        <span>Ëá™Âä®</span>
                    </label>
                </div>
                <div class="row" style="font-size:12px;opacity:0.8;margin-bottom:0">
                    <span>Â∑≤ÂêåÊ≠•: </span>
                    <span id="lastSyncTime">--</span>
                </div>
            </div>

            <!-- Motor Control Card -->
            <div class="card">
                <h2>üéõÔ∏è ÁîµÊú∫ÊéßÂà∂</h2>
                <div class="row">
                    <label style="display:flex;align-items:center;gap:8px;cursor:default;font-size:12px;flex:1">
                        <span style="opacity:0.85;min-width:56px;">ËåÉÂõ¥: </span>
                        <input type="number" id="motorMin" value="0" placeholder="ÊúÄÂ∞èÂÄº" style="width:60px;flex:none"
                            aria-label="ÁîµÊú∫ÊúÄÂ∞èÂÄº" title="ÁîµÊú∫ÁöÑÊúÄÂ∞èÂéüÂßãÂÄº">
                        <span>-</span>
                        <input type="number" id="motorMax" value="1000" placeholder="ÊúÄÂ§ßÂÄº" style="width:60px;flex:none"
                            aria-label="ÁîµÊú∫ÊúÄÂ§ßÂÄº" title="ÁîµÊú∫ÁöÑÊúÄÂ§ßÂéüÂßãÂÄº">
                    </label>
                    <button onclick="updateConfig()">Â∫îÁî®</button>
                </div>
                <div class="slider-container">
                    <input type="range" id="motorSlider" min="0" max="100" value="0" oninput="onMotorSliderInput()">
                </div>
                <div class="row">
                    <label style="display:flex;align-items:center;gap:8px;cursor:default;font-size:12px;">
                        <span style="opacity:0.85;min-width:56px;">Âç†ÊØî: </span>
                        <input type="number" id="motorPercent" value="0" min="0" max="100" placeholder="%"
                            aria-label="ÁîµÊú∫Âç†ÊØî" title="ËÆæÁΩÆÁîµÊú∫Âç†Á©∫ÊØîÁôæÂàÜÊØî">
                    </label>
                    <button onclick="setMotor()">ËÆæÁΩÆ</button>
                    <label style="display:flex;align-items:center;gap:4px;cursor:pointer;font-size:12px;">
                        <input type="checkbox" id="immediateMode" style="width:auto;" onchange="onImmediateModeChange()"
                            aria-label="Á´ãÂç≥Ê®°Âºè" title="ÂãæÈÄâÂêé‰ºöÁ´ãÂç≥Â∫îÁî®ËÆæÁΩÆ">
                        <span>Á´ãÂç≥</span>
                    </label>
                </div>
            </div>

            <!-- Monitor Card -->
            <div class="card">
                <h2>üìä ÁõëÊéß</h2>
                <div class="value-display" id="monitorValue" style="font-size:1.5em;margin:4px 0">0.00%</div>
                <div class="meter">
                    <div class="meter-fill" id="meterFill" style="width: 0%"></div>
                </div>
                <div class="row">
                    <label style="display:flex;align-items:center;gap:8px;cursor:default;font-size:12px;">
                        <span style="opacity:0.85;min-width:56px;">Ê®°Âºè: </span>
                        <select id="monitorMode" onchange="onMonitorModeChange()" aria-label="ÁõëÊéßÊ®°Âºè"
                            title="ÈÄâÊã©ÁõëÊéßÊù•Ê∫êÔºàCPU/ÂÜÖÂ≠ò/GPU/Èü≥È¢ëÔºâ">
                            <!-- ÈÄâÈ°πÁî± JavaScript Âä®ÊÄÅÂä†ËΩΩ -->
                        </select>
                    </label>
                </div>
                <div class="row">
                    <label style="display:flex;align-items:center;gap:8px;cursor:default;font-size:12px;">
                        <span style="opacity:0.85;min-width:56px;">Âë®Êúü: </span>
                        <input type="number" id="period" value="1000" min="1" max="5000" style="width:50px;flex:none"
                            onchange="onPeriodChange()" aria-label="ÁõëÊéßÂë®Êúü" title="ÁõëÊéßÂë®ÊúüÔºåÂçï‰ΩçÊØ´Áßí">
                    </label>
                    <span style="font-size:11px;opacity:0.7;">ms</span>
                    <button id="monitorStartBtn" onclick="toggleMonitor()" class="success">ÂºÄÂßã</button>
                </div>
                <div class="row" style="margin-bottom:0">
                    <label style="display:flex;align-items:center;gap:8px;cursor:default;font-size:12px;flex:1">
                        <input type="checkbox" id="thresholdEnable" style="width:auto;" onchange="onThresholdChange()">
                        <span style="opacity:0.85;">Êä•Ë≠¶ÈòàÂÄº: </span>
                        <input type="number" id="thresholdValue" value="80" min="0" max="100"
                            style="width:40px;flex:none" aria-label="Êä•Ë≠¶ÈòàÂÄº" title="Ë∂ÖËøáÊ≠§ÈòàÂÄºÊó∂Ëß¶ÂèëÊä•Ë≠¶">
                        <span style="font-size:11px;opacity:0.7;">%</span>
                        <input type="number" id="thresholdFreq" value="1046" min="100" max="5000"
                            style="width:55px;flex:none" aria-label="Êä•Ë≠¶È¢ëÁéá" title="Êä•Ë≠¶Èü≥È¢ëÁéá(Hz)">
                        <span style="font-size:11px;opacity:0.7;">Hz</span>
                        <input type="number" id="thresholdDuration" value="100" min="10" max="2000"
                            style="width:50px;flex:none" aria-label="Êä•Ë≠¶Êó∂Èïø" title="Êä•Ë≠¶Èü≥ÊåÅÁª≠Êó∂Èó¥(ms)">
                        <span style="font-size:11px;opacity:0.7;">ms</span>
                    </label>
                </div>
                <div class="row" style="margin-bottom:0">
                    <label style="display:flex;align-items:center;gap:8px;cursor:default;font-size:12px;flex:1">
                        <input type="checkbox" id="cmdFileEnable" style="width:auto;" onchange="onCmdFileChange()">
                        <span style="opacity:0.85;">Êñá‰ª∂ÁõëÊéß: </span>
                        <input type="text" id="cmdFilePath" value="/tmp/dutycycle_cmd.txt"
                            style="flex:1;min-width:100px" aria-label="ÂëΩ‰ª§Êñá‰ª∂Ë∑ØÂæÑ" title="ÁõëÊéßÊ≠§Êñá‰ª∂ÔºåÂΩìÊñá‰ª∂Â≠òÂú®Êó∂ËØªÂèñÂëΩ‰ª§ÂèëÈÄÅÂà∞ËÆæÂ§á"
                            onchange="onCmdFileChange()">
                    </label>
                </div>
            </div>

            <!-- Alarm Card -->
            <div class="card wide">
                <h2>‚è∞ ÈóπÈíüËÆæÁΩÆ</h2>
                <!-- Alarm Settings -->
                <div class="row">
                    <span style="font-size:12px;width:40px;">ÈóπÈíü:</span>
                    <select id="alarmId" style="width:50px;flex:none">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                    <input type="number" id="alarmHour" min="0" max="23" value="8" style="width:45px;flex:none"
                        placeholder="Êó∂">
                    <span>:</span>
                    <input type="number" id="alarmMinute" min="0" max="59" value="0" style="width:45px;flex:none"
                        placeholder="ÂàÜ">
                    <select id="alarmMusic" style="width:60px;flex:none">
                        <option value="0">Èü≥‰πê0</option>
                        <option value="1">Èü≥‰πê1</option>
                        <option value="2">Èü≥‰πê2</option>
                        <option value="3">Ëá™ÂÆö‰πâ</option>
                    </select>
                    <button onclick="alarmSet()" class="success">ËÆæÁΩÆ</button>
                    <button onclick="alarmList()">ÂàóÂá∫ÊâÄÊúâÈóπÈíü</button>
                    <button onclick="alarmDelete()" class="danger">Âà†Èô§</button>
                </div>
                <!-- Hourly Chime Filter -->
                <div class="row">
                    <span style="font-size:12px;width:40px;">Êä•Êó∂:</span>
                    <input type="text" id="hourlyFilter" placeholder="Êï¥ÁÇπËøáÊª§ Â¶Ç:8,9,10,11,12" style="flex:2">
                    <button onclick="alarmSetFilter()" class="warning">Â∫îÁî®Â∞èÊó∂ËøáÊª§Âô®</button>
                    <input type="number" id="hourlyHour" min="0" max="23" value="12" style="width:50px;flex:none"
                        placeholder="Êó∂">
                    <button onclick="alarmPlayHourly()">È¢ÑËßàÊä•Êó∂</button>
                </div>
                <!-- Music Control -->
                <div class="row">
                    <span style="font-size:12px;width:40px;">Èü≥‰πê:</span>
                    <select id="musicId" style="width:60px;flex:none" onchange="onMusicIdChange()">
                        <option value="0">Èü≥‰πê0</option>
                        <option value="1">Èü≥‰πê1</option>
                        <option value="2">Èü≥‰πê2</option>
                        <option value="3" selected>Ëá™ÂÆö‰πâ</option>
                    </select>
                    <button onclick="alarmListMusic()">ÂàóÂá∫Èü≥‰πê‰ø°ÊÅØ</button>
                    <button onclick="alarmPlayMusic()" class="success">Êí≠Êîæ</button>
                    <button onclick="alarmClearMusic()" class="danger">Ê∏ÖÈô§</button>
                    <button onclick="alarmSaveMusic()">‰øùÂ≠ò</button>
                </div>
            </div>

            <!-- Music Composer Card -->
            <div class="card wide">
                <h2>üéµ ÁºñÊõ≤Âô® <span style="font-size:11px;opacity:0.7;">(8Èü≥Á¨¶Â∫èÂàó)</span></h2>
                <div class="row">
                    <span style="font-size:12px;">BPM:</span>
                    <input type="number" id="composerBpm" min="20" max="300" value="80" style="width:60px;flex:none">
                    <button onclick="composerClear()" class="danger">Ê∏ÖÁ©∫</button>
                    <button onclick="composerUpload()" class="warning">‰∏ä‰º†Âà∞ËÆæÂ§á</button>
                    <button onclick="composerPlayAll()" class="success">‚ñ∂ ‰∏ä‰º†Âπ∂Êí≠Êîæ</button>
                </div>
                <!-- Piano Roll / Note Grid -->
                <div style="display:flex;gap:4px;margin:8px 0;flex-wrap:wrap;" id="noteGrid">
                </div>
                <!-- Note Editor -->
                <div class="row" style="background:rgba(0,0,0,0.2);padding:8px;border-radius:6px;">
                    <span style="font-size:12px;">Èü≥Á¨¶#</span>
                    <select id="editNoteIndex" style="width:50px;flex:none" onchange="loadNoteToEditor()">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                    </select>
                    <select id="editNotePitch" style="width:90px;flex:none" onchange="onNoteEditorChange()">
                        <option value="0">‰ºëÊ≠¢</option>
                        <optgroup label="‰ΩéÈü≥">
                            <option value="262">L1(Do)</option>
                            <option value="277">L1#</option>
                            <option value="294">L2(Re)</option>
                            <option value="311">L2#</option>
                            <option value="330">L3(Mi)</option>
                            <option value="349">L4(Fa)</option>
                            <option value="370">L4#</option>
                            <option value="392">L5(So)</option>
                            <option value="415">L5#</option>
                            <option value="440">L6(La)</option>
                            <option value="466">L6#</option>
                            <option value="494">L7(Si)</option>
                        </optgroup>
                        <optgroup label="‰∏≠Èü≥">
                            <option value="523">M1(Do)</option>
                            <option value="554">M1#</option>
                            <option value="587">M2(Re)</option>
                            <option value="622">M2#</option>
                            <option value="659">M3(Mi)</option>
                            <option value="698">M4(Fa)</option>
                            <option value="740">M4#</option>
                            <option value="784">M5(So)</option>
                            <option value="831">M5#</option>
                            <option value="880">M6(La)</option>
                            <option value="932">M6#</option>
                            <option value="988">M7(Si)</option>
                        </optgroup>
                        <optgroup label="È´òÈü≥">
                            <option value="1046">H1(Do)</option>
                            <option value="1109">H1#</option>
                            <option value="1175">H2(Re)</option>
                            <option value="1245">H2#</option>
                            <option value="1318">H3(Mi)</option>
                            <option value="1397">H4(Fa)</option>
                            <option value="1480">H4#</option>
                            <option value="1568">H5(So)</option>
                            <option value="1661">H5#</option>
                            <option value="1760">H6(La)</option>
                            <option value="1865">H6#</option>
                            <option value="1976">H7(Si)</option>
                        </optgroup>
                    </select>
                    <select id="editNoteBeat" style="width:60px;flex:none" onchange="onNoteEditorChange()">
                        <option value="47">1/16</option>
                        <option value="94">1/8</option>
                        <option value="188" selected>1/4</option>
                        <option value="375">1/2</option>
                        <option value="750">1</option>
                        <option value="1500">2</option>
                    </select>
                    <button onclick="playNoteLocal()">üîä ËØïÂê¨</button>
                    <button onclick="playAllLocal()" class="success">‚ñ∂ È¢ÑËßà</button>
                </div>
            </div>

            <!-- Terminal Card -->
            <div class="card full">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                    <h2 style="margin:0;border:none;padding:0;">üíª ÁªàÁ´Ø</h2>
                    <div style="display:flex;gap:8px;">
                        <button onclick="clearTerminal()" class="danger"
                            style="height:24px;font-size:12px;padding:0 8px;">Ê∏ÖÁ©∫</button>
                    </div>
                </div>
                <div id="terminal-container" style="height:320px;"></div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>

</html>