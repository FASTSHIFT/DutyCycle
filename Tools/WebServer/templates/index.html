<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DutyCycle Studio</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- xterm.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-brand">
                <h1><a href="https://github.com/FASTSHIFT/DutyCycle" target="_blank" class="brand-link">DutyCycle</a>
                    <span class="brand-suffix">Studio</span>
                </h1>
            </div>
            <div class="header-status">
                <span class="status-indicator" id="connectionIndicator"></span>
                <span id="connectionStatus" class="status-text disconnected">Êú™ËøûÊé•</span>
            </div>
            <div class="header-actions">
                <label class="mode-switch" title="ÂàáÊç¢È´òÁ∫ßÊ®°ÂºèÔºåÊòæÁ§∫ÁªàÁ´ØÂíåË∞ÉËØïÂäüËÉΩ">
                    <input type="checkbox" id="advancedMode" onchange="onAdvancedModeChange()">
                    <span class="mode-switch-slider"></span>
                    <span class="mode-switch-label">È´òÁ∫ßÊ®°Âºè</span>
                </label>
                <p class="author">by <a href="https://github.com/FASTSHIFT" target="_blank">_VIFEXTech</a></p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Sidebar: Device & Quick Actions -->
            <aside class="sidebar">
                <!-- Device Tabs -->
                <div class="device-tabs" id="deviceTabs">
                    <div class="device-tab active" data-device-id="device_0" onclick="switchDevice('device_0')">
                        <span class="device-tab-name">ËÆæÂ§á1</span>
                        <span class="device-tab-status disconnected"></span>
                    </div>
                    <button class="device-tab-add" onclick="addDevice()" title="Ê∑ªÂä†ËÆæÂ§á">+</button>
                </div>

                <!-- Device Connection Panel -->
                <section class="panel panel-primary" id="panelDevice">
                    <div class="panel-header">
                        <h2><span class="panel-icon">üîå</span> ËÆæÂ§áËøûÊé•</h2>
                        <button class="btn btn-icon btn-sm device-settings-btn" onclick="showDeviceSettings()"
                            title="ËÆæÂ§áËÆæÁΩÆ">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                                </path>
                            </svg>
                        </button>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="form-label" for="portSelect">‰∏≤Âè£</label>
                            <div class="input-group">
                                <select id="portSelect" class="form-control" title="ÈÄâÊã©Ë¶ÅËøûÊé•ÁöÑ‰∏≤Âè£ËÆæÂ§á">
                                    <option value="">ÈÄâÊã©‰∏≤Âè£...</option>
                                </select>
                                <button class="btn btn-icon" onclick="refreshPorts()" title="Âà∑Êñ∞‰∏≤Âè£ÂàóË°®">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path
                                            d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="baudrate">Ê≥¢ÁâπÁéá
                                <span class="form-hint" title="Â∏∏Áî®Ê≥¢ÁâπÁéáÔºö9600, 115200, 921600">‚ìò</span>
                            </label>
                            <input type="number" id="baudrate" class="form-control" value="115200" placeholder="115200"
                                title="ËæìÂÖ•‰∏≤Âè£Ê≥¢ÁâπÁéá">
                        </div>
                        <button id="connectBtn" class="btn btn-primary btn-block" onclick="toggleConnect()">
                            <span class="btn-icon-left">‚ö°</span> ËøûÊé•
                        </button>
                    </div>
                </section>

                <!-- Quick Status Panel -->
                <section class="panel" id="panelQuickStatus">
                    <div class="panel-header">
                        <h2><span class="panel-icon">üìä</span> ÂÆûÊó∂Áä∂ÊÄÅ</h2>
                        <span class="panel-badge" id="monitorBadge">ÂÅúÊ≠¢</span>
                    </div>
                    <div class="panel-body">
                        <!-- Channel 0 -->
                        <div class="stat-display dual-channel">
                            <div class="stat-channel">
                                <span class="channel-label">CH0</span>
                                <span class="stat-value" id="monitorValue0">0.00<span class="stat-unit">%</span></span>
                            </div>
                            <div class="stat-channel">
                                <span class="channel-label">CH1</span>
                                <span class="stat-value" id="monitorValue1">0.00<span class="stat-unit">%</span></span>
                            </div>
                        </div>
                        <div class="progress-bar-dual">
                            <div class="progress-bar-row">
                                <span class="progress-label">CH0</span>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="meterFill0" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="progress-bar-row">
                                <span class="progress-label">CH1</span>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="meterFill1" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Clock Sync (Compact) -->
                <section class="panel panel-compact" id="panelClock">
                    <div class="panel-header">
                        <h2><span class="panel-icon">üïê</span> Êó∂ÈíüÂêåÊ≠•</h2>
                    </div>
                    <div class="panel-body">
                        <div class="inline-row">
                            <button onclick="syncClock()" class="btn btn-success btn-sm" title="Â∞ÜPCÊó∂Èó¥ÂêåÊ≠•Âà∞ËÆæÂ§á">
                                ÂêåÊ≠•Êó∂Èó¥
                            </button>
                            <label class="checkbox-inline" title="ÊØè24Â∞èÊó∂Ëá™Âä®ÂêåÊ≠•‰∏ÄÊ¨°">
                                <input type="checkbox" id="autoSyncClock" onchange="onAutoSyncChange()">
                                <span>Ëá™Âä®</span>
                            </label>
                        </div>
                        <div class="form-hint-block">
                            <span class="hint-label">‰∏äÊ¨°ÂêåÊ≠•:</span>
                            <span id="lastSyncTime">--</span>
                        </div>
                    </div>
                </section>
            </aside>

            <!-- Center Content -->
            <div class="content-area">
                <!-- Control Section -->
                <section class="section" id="sectionControl">
                    <div class="section-header">
                        <h2><span class="section-icon">üéõÔ∏è</span> ÊéßÂà∂Èù¢Êùø</h2>
                    </div>
                    <div class="section-body">
                        <div class="card-grid">
                            <!-- Motor Control Card -->
                            <div class="card card-control" id="cardMotor">
                                <div class="card-header">
                                    <h3>ÁîµÊú∫ÊéßÂà∂</h3>
                                    <span class="card-badge editable">ÂèåÈÄöÈÅì</span>
                                </div>
                                <div class="card-body">
                                    <!-- Range Config -->
                                    <div class="config-row">
                                        <div class="form-group form-group-inline">
                                            <label class="form-label">PWM ËåÉÂõ¥
                                                <span class="form-hint" title="ÁîµÊú∫PWMÁöÑÂéüÂßãÊï∞ÂÄºËåÉÂõ¥ÔºåÁî®‰∫éÁôæÂàÜÊØîËΩ¨Êç¢">‚ìò</span>
                                            </label>
                                            <div class="range-inputs">
                                                <input type="number" id="motorMin" class="form-control form-control-sm"
                                                    value="0" placeholder="ÊúÄÂ∞è" title="ÁîµÊú∫ÊúÄÂ∞èÂéüÂßãÂÄº">
                                                <span class="range-separator">-</span>
                                                <input type="number" id="motorMax" class="form-control form-control-sm"
                                                    value="1000" placeholder="ÊúÄÂ§ß" title="ÁîµÊú∫ÊúÄÂ§ßÂéüÂßãÂÄº">
                                            </div>
                                        </div>
                                        <button onclick="updateConfig()" class="btn btn-secondary btn-sm"
                                            title="Â∫îÁî®ËåÉÂõ¥ÈÖçÁΩÆ">Â∫îÁî®</button>
                                    </div>

                                    <!-- Channel 0 Slider -->
                                    <div class="slider-section channel-section">
                                        <div class="channel-header">
                                            <span class="channel-tag">CH0</span>
                                            <select id="unitSelect0" class="form-control form-control-sm unit-select" onchange="onUnitChange(0)">
                                                <option value="NONE">NONE</option>
                                                <option value="HOUR">HOUR</option>
                                                <option value="HOUR_COS_PHI">HOUR_COS_PHI</option>
                                                <option value="MINUTE">MINUTE</option>
                                                <option value="SECOND">SECOND</option>
                                            </select>
                                            <span id="motorPwmValue0" class="pwm-value-display">PWM: 0</span>
                                        </div>
                                        <input type="range" id="motorSlider0" class="slider-main" min="0" max="100"
                                            value="0" step="0.01" oninput="onMotorSliderInput(0)">
                                    </div>

                                    <!-- Channel 1 Slider -->
                                    <div class="slider-section channel-section">
                                        <div class="channel-header">
                                            <span class="channel-tag">CH1</span>
                                            <select id="unitSelect1" class="form-control form-control-sm unit-select" onchange="onUnitChange(1)">
                                                <option value="NONE">NONE</option>
                                                <option value="HOUR">HOUR</option>
                                                <option value="HOUR_COS_PHI" disabled>HOUR_COS_PHI</option>
                                                <option value="MINUTE">MINUTE</option>
                                                <option value="SECOND">SECOND</option>
                                            </select>
                                            <span id="motorPwmValue1" class="pwm-value-display">PWM: 0</span>
                                        </div>
                                        <input type="range" id="motorSlider1" class="slider-main" min="0" max="100"
                                            value="0" step="0.01" oninput="onMotorSliderInput(1)">
                                    </div>

                                    <div class="slider-labels">
                                        <span>0%</span>
                                        <span>50%</span>
                                        <span>100%</span>
                                    </div>

                                    <!-- Precise Control -->
                                    <div class="action-row">
                                        <div class="form-group form-group-mini">
                                            <label class="form-label">ÈÄöÈÅì</label>
                                            <select id="motorChannel" class="form-control form-control-sm">
                                                <option value="0">CH0</option>
                                                <option value="1">CH1</option>
                                                <option value="both">ÂèåÈÄöÈÅì</option>
                                            </select>
                                        </div>
                                        <div class="input-with-unit">
                                            <input type="number" id="motorPercent" class="form-control" value="0"
                                                min="0" max="100" step="0.01" placeholder="Âç†Á©∫ÊØî" title="ËÆæÁΩÆÁîµÊú∫Âç†Á©∫ÊØîÁôæÂàÜÊØî">
                                            <span class="input-unit">%</span>
                                        </div>
                                        <button onclick="setMotor()" class="btn btn-primary"
                                            title="ÂèëÈÄÅÂç†Á©∫ÊØîËÆæÁΩÆÂëΩ‰ª§">ËÆæÁΩÆ</button>
                                        <label class="checkbox-inline" title="ÂãæÈÄâÂêéÊãñÂä®ÊªëÂùóÁ´ãÂç≥ÁîüÊïà">
                                            <input type="checkbox" id="immediateMode"
                                                onchange="onImmediateModeChange()">
                                            <span>Á´ãÂç≥</span>
                                        </label>
                                    </div>

                                    <!-- Advanced Motor Settings - Collapsible -->
                                    <div class="form-section form-section-collapsible collapsed"
                                        id="advancedMotorSettings" style="margin-top: 12px;">
                                        <div class="form-section-title clickable" onclick="toggleAdvancedSettings()">
                                            <span class="collapse-icon">‚ñ∂</span> È´òÁ∫ßËÆæÁΩÆ
                                        </div>
                                        <div class="form-section-content">
                                            <!-- Clock Mapping Setting -->
                                            <div class="form-subsection">
                                                <div class="form-subsection-title">Êó∂ÈíüÊò†Â∞ÑÈÖçÁΩÆ</div>
                                                <div class="form-row">
                                                    <div class="form-group form-group-mini">
                                                        <label class="form-label">ÈÄöÈÅì</label>
                                                        <select id="clockMapChannel" class="form-control form-control-sm" onchange="updateClockMapHourOptions()">
                                                            <option value="0">CH0</option>
                                                            <option value="1">CH1</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="form-label">Á¥¢Âºï
                                                            <span class="form-hint" title="HOUR: 0-24Â∞èÊó∂, MINUTE/SECOND: 0-6ÂØπÂ∫î0,10,20,30,40,50,60">‚ìò</span>
                                                        </label>
                                                        <select id="clockMapHour" class="form-control form-control-sm">
                                                            <!-- ÈÄâÈ°πÁî± JavaScript Âä®ÊÄÅÂä†ËΩΩ -->
                                                        </select>
                                                    </div>
                                                    <button onclick="setClockMap()" class="btn btn-warning btn-sm"
                                                        title="Â∞ÜÂΩìÂâçÊªëÂùóPWMÂÄºËÆæÁΩÆÂà∞ÈÄâÂÆöÁ¥¢Âºï">ËÆæÁΩÆÊò†Â∞Ñ</button>
                                                    <button onclick="listClockMap()" class="btn btn-secondary btn-sm"
                                                        title="ÂàóÂá∫ÂΩìÂâçÂ∞èÊó∂Êò†Â∞ÑÈÖçÁΩÆ">ÂàóÂá∫</button>
                                                </div>
                                            </div>

                                            <!-- Sweep Test -->
                                            <div class="form-subsection">
                                                <button onclick="sweepTest()" class="btn btn-success btn-block"
                                                    title="ÊâßË°åÁîµÊú∫Êâ´Âä®ÊµãËØï">üîÑ Êâ´Âä®ÊµãËØï</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Monitor Config Card -->
                            <div class="card card-monitor" id="cardMonitor">
                                <div class="card-header">
                                    <h3>ÁõëÊéßÈÖçÁΩÆ</h3>
                                    <span class="card-badge editable">ÂèØÁºñËæë</span>
                                </div>
                                <div class="card-body">
                                    <!-- CH0 ÁõëÊéßÈÖçÁΩÆ -->
                                    <div class="channel-config-section">
                                        <div class="channel-config-header">
                                            <span class="channel-tag ch0">CH0</span>
                                            <label class="form-label">ÁõëÊéßÊ∫ê</label>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <select id="monitorMode0" class="form-control form-control-sm"
                                                    onchange="onMonitorModeChange(0)">
                                                    <option value="none">Êó†</option>
                                                    <option value="cpu-usage">CPU ‰ΩøÁî®Áéá</option>
                                                    <option value="mem-usage">ÂÜÖÂ≠ò‰ΩøÁî®Áéá</option>
                                                    <option value="gpu-usage">GPU ‰ΩøÁî®Áéá</option>
                                                    <option value="audio-left">Èü≥È¢ë Â∑¶Â£∞ÈÅì</option>
                                                    <option value="audio-right">Èü≥È¢ë Âè≥Â£∞ÈÅì</option>
                                                    <option value="audio-mix">Èü≥È¢ë Ê∑∑Âêà</option>
                                                </select>
                                            </div>
                                            <div class="form-group form-group-mini">
                                                <label class="form-label">Âë®Êúü</label>
                                                <div class="input-with-unit">
                                                    <input type="number" id="period0" class="form-control form-control-sm" value="1000"
                                                        min="1" max="5000" onchange="onPeriodChange(0)" title="CH0ÈááÊ†∑Èó¥Èöî">
                                                    <span class="input-unit">ms</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CH1 ÁõëÊéßÈÖçÁΩÆ -->
                                    <div class="channel-config-section">
                                        <div class="channel-config-header">
                                            <span class="channel-tag ch1">CH1</span>
                                            <label class="form-label">ÁõëÊéßÊ∫ê</label>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <select id="monitorMode1" class="form-control form-control-sm"
                                                    onchange="onMonitorModeChange(1)">
                                                    <option value="none">Êó†</option>
                                                    <option value="cpu-usage">CPU ‰ΩøÁî®Áéá</option>
                                                    <option value="mem-usage">ÂÜÖÂ≠ò‰ΩøÁî®Áéá</option>
                                                    <option value="gpu-usage">GPU ‰ΩøÁî®Áéá</option>
                                                    <option value="audio-left">Èü≥È¢ë Â∑¶Â£∞ÈÅì</option>
                                                    <option value="audio-right">Èü≥È¢ë Âè≥Â£∞ÈÅì</option>
                                                    <option value="audio-mix">Èü≥È¢ë Ê∑∑Âêà</option>
                                                </select>
                                            </div>
                                            <div class="form-group form-group-mini">
                                                <label class="form-label">Âë®Êúü</label>
                                                <div class="input-with-unit">
                                                    <input type="number" id="period1" class="form-control form-control-sm" value="1000"
                                                        min="1" max="5000" onchange="onPeriodChange(1)" title="CH1ÈááÊ†∑Èó¥Èöî">
                                                    <span class="input-unit">ms</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Èü≥È¢ëÂÖ±‰∫´ËÆæÁΩÆ -->
                                    <div class="form-row audio-shared-settings" id="audioSettingsRow" style="display:none;">
                                        <div class="form-group" id="audioDbRangeRow">
                                            <label class="form-label">dBÊò†Â∞Ñ
                                                <span class="form-hint" title="Â∞ÜÊ≠§dBËåÉÂõ¥Êò†Â∞ÑÂà∞0%~100%">‚ìò</span>
                                            </label>
                                            <div class="range-inputs">
                                                <input type="number" id="audioDbMin"
                                                    class="form-control form-control-sm" value="-40" placeholder="ÊúÄÂ∞èdB"
                                                    title="ÊúÄÂ∞èdBÂÄº(Êò†Â∞ÑÂà∞0%)" onchange="onAudioDbRangeChange()">
                                                <span class="range-separator">~</span>
                                                <input type="number" id="audioDbMax"
                                                    class="form-control form-control-sm" value="0" placeholder="ÊúÄÂ§ßdB"
                                                    title="ÊúÄÂ§ßdBÂÄº(Êò†Â∞ÑÂà∞100%)" onchange="onAudioDbRangeChange()">
                                                <span class="input-unit">dB</span>
                                            </div>
                                        </div>
                                        <div class="form-group" id="audioDeviceRow">
                                            <label class="form-label">Èü≥È¢ëËæìÂÖ•
                                                <span class="form-hint" title="ÈÄâÊã©Ë¶ÅÁõëÂê¨ÁöÑÈü≥È¢ëËæìÂÖ•ËÆæÂ§á">‚ìò</span>
                                            </label>
                                            <div class="input-group">
                                                <select id="audioDevice" class="form-control"
                                                    onchange="onAudioDeviceChange()">
                                                    <option value="">Ëá™Âä®ÈÄâÊã©...</option>
                                                    <!-- ÈÄâÈ°πÁî± JavaScript Âä®ÊÄÅÂä†ËΩΩ -->
                                                </select>
                                                <button class="btn btn-icon" onclick="refreshAudioDevices()"
                                                    title="Âà∑Êñ∞Èü≥È¢ëËÆæÂ§áÂàóË°®">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2">
                                                        <path
                                                            d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15" />
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="margin-top: 16px;">
                                        <button id="monitorStartBtn" onclick="toggleMonitor()"
                                            class="btn btn-success btn-block">
                                            <span class="btn-icon-left">‚ñ∂</span> ÂºÄÂßãÁõëÊéß
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Automation Section -->
                <section class="section section-collapsible" id="sectionAutomation">
                    <div class="section-header" onclick="toggleSection('sectionAutomation')">
                        <h2><span class="section-icon">‚öôÔ∏è</span> Ëá™Âä®Âåñ & Êä•Ë≠¶</h2>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-body">
                        <div class="card-grid">
                            <!-- Threshold Alert -->
                            <div class="card" id="cardAlert">
                                <div class="card-header">
                                    <h3>ÈòàÂÄºÊä•Ë≠¶</h3>
                                    <label class="switch-mini">
                                        <input type="checkbox" id="thresholdEnable" onchange="onThresholdChange()">
                                        <span class="switch-slider"></span>
                                    </label>
                                </div>
                                <div class="card-body">
                                    <div class="form-row form-row-compact">
                                        <div class="form-group">
                                            <label class="form-label">ÁõëÊéßÂØπË±°
                                                <span class="form-hint" title="ÈÄâÊã©Ë¶ÅÁõëÊéßÁöÑÁ≥ªÁªüËµÑÊ∫ê">‚ìò</span>
                                            </label>
                                            <select id="thresholdMonitorMode" class="form-control form-control-sm"
                                                onchange="onThresholdChange()">
                                                <!-- ÈÄâÈ°πÁî± JavaScript Âä®ÊÄÅÂä†ËΩΩÔºàÊéíÈô§Èü≥È¢ëÔºâ -->
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Ëß¶ÂèëÈòàÂÄº</label>
                                            <div class="input-with-unit">
                                                <input type="number" id="thresholdValue"
                                                    class="form-control form-control-sm" value="80" min="0" max="100"
                                                    title="Ë∂ÖËøáÊ≠§ÂÄºËß¶ÂèëÊä•Ë≠¶" onchange="onThresholdChange()">
                                                <span class="input-unit">%</span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Êä•Ë≠¶Èü≥È´ò</label>
                                            <select id="thresholdFreq" class="form-control form-control-sm"
                                                onchange="onThresholdChange()">
                                                <!-- Áî± JavaScript Âä®ÊÄÅÂ°´ÂÖÖ -->
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">ÊåÅÁª≠Êó∂Èó¥</label>
                                            <div class="input-with-unit">
                                                <input type="number" id="thresholdDuration"
                                                    class="form-control form-control-sm" value="100" min="10" max="2000"
                                                    title="Êä•Ë≠¶Èü≥ÊåÅÁª≠Êó∂Èó¥" onchange="onThresholdChange()">
                                                <span class="input-unit">ms</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- File Monitor -->
                            <div class="card" id="cardFileMonitor">
                                <div class="card-header">
                                    <h3>Êñá‰ª∂ÁõëÊéß</h3>
                                    <label class="switch-mini">
                                        <input type="checkbox" id="cmdFileEnable" onchange="onCmdFileChange()">
                                        <span class="switch-slider"></span>
                                    </label>
                                </div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label class="form-label">ÂëΩ‰ª§Êñá‰ª∂Ë∑ØÂæÑ
                                            <span class="form-hint"
                                                title="ÁõëÊéßÊ≠§Êñá‰ª∂ÔºåÂ≠òÂú®Êó∂ËØªÂèñÂëΩ‰ª§Âπ∂ÂèëÈÄÅÂà∞ËÆæÂ§á„ÄÇÊ≥®ÊÑèÔºöÈúÄË¶ÅÂÖàÂêØÂä®ÁõëÊéßÊâçËÉΩ‰ΩøÁî®Ê≠§ÂäüËÉΩ">‚ìò</span>
                                        </label>
                                        <input type="text" id="cmdFilePath" class="form-control"
                                            value="/tmp/dutycycle_cmd.txt" onchange="onCmdFileChange()">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Alarm Settings -->
                        <div class="card card-wide" id="cardAlarm">
                            <div class="card-header">
                                <h3>‚è∞ ÈóπÈíüÁÆ°ÁêÜ</h3>
                            </div>
                            <div class="card-body">
                                <!-- Alarm Setting Row -->
                                <div class="form-section">
                                    <div class="form-section-title">ÈóπÈíüËÆæÁΩÆ</div>
                                    <div class="form-row">
                                        <div class="form-group form-group-mini">
                                            <label class="form-label">ID</label>
                                            <select id="alarmId" class="form-control form-control-sm">
                                                <option value="0">0</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Êó∂Èó¥</label>
                                            <div class="time-input">
                                                <input type="number" id="alarmHour" class="form-control form-control-sm"
                                                    min="0" max="23" value="8" placeholder="Êó∂">
                                                <span class="time-sep">:</span>
                                                <input type="number" id="alarmMinute"
                                                    class="form-control form-control-sm" min="0" max="59" value="0"
                                                    placeholder="ÂàÜ">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">ÈìÉÂ£∞</label>
                                            <select id="alarmMusic" class="form-control form-control-sm">
                                                <option value="0">Èü≥‰πê0</option>
                                                <option value="1">Èü≥‰πê1</option>
                                                <option value="2">Èü≥‰πê2</option>
                                                <option value="3">Ëá™ÂÆö‰πâ</option>
                                            </select>
                                        </div>
                                        <div class="btn-group">
                                            <button onclick="alarmSet()" class="btn btn-success btn-sm">ËÆæÁΩÆ</button>
                                            <button onclick="alarmList()" class="btn btn-secondary btn-sm">ÂàóÂá∫</button>
                                            <button onclick="alarmDelete()" class="btn btn-danger btn-sm">Âà†Èô§</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Hourly Chime Row -->
                                <div class="form-section">
                                    <div class="form-section-title">Êï¥ÁÇπÊä•Êó∂</div>
                                    <div class="form-row">
                                        <div class="form-group flex-grow">
                                            <label class="form-label">Â∞èÊó∂ËøáÊª§
                                                <span class="form-hint" title="ËÆæÁΩÆÂì™‰∫õÂ∞èÊó∂Êä•Êó∂ÔºåÁî®ÈÄóÂè∑ÂàÜÈöî">‚ìò</span>
                                            </label>
                                            <input type="text" id="hourlyFilter" class="form-control"
                                                placeholder="Â¶Ç: 8,9,10,11,12,18,19,20">
                                        </div>
                                        <button onclick="alarmSetFilter()" class="btn btn-warning btn-sm">Â∫îÁî®</button>
                                        <div class="form-group form-group-mini">
                                            <label class="form-label">È¢ÑËßà</label>
                                            <input type="number" id="hourlyHour" class="form-control form-control-sm"
                                                min="0" max="23" value="12" placeholder="Êó∂">
                                        </div>
                                        <button onclick="alarmPlayHourly()" class="btn btn-secondary btn-sm">Êí≠Êîæ</button>
                                    </div>
                                </div>

                                <!-- Music Control Row -->
                                <div class="form-section">
                                    <div class="form-section-title">Èü≥‰πêÊéßÂà∂</div>
                                    <div class="form-row">
                                        <div class="form-group form-group-mini">
                                            <label class="form-label">Èü≥‰πê</label>
                                            <select id="musicId" class="form-control form-control-sm"
                                                onchange="onMusicIdChange()">
                                                <option value="0">Èü≥‰πê0</option>
                                                <option value="1">Èü≥‰πê1</option>
                                                <option value="2">Èü≥‰πê2</option>
                                                <option value="3" selected>Ëá™ÂÆö‰πâ</option>
                                            </select>
                                        </div>
                                        <div class="btn-group">
                                            <button onclick="alarmListMusic()"
                                                class="btn btn-secondary btn-sm">ÂàóÂá∫</button>
                                            <button onclick="alarmPlayMusic()"
                                                class="btn btn-success btn-sm">Êí≠Êîæ</button>
                                            <button onclick="alarmClearMusic()"
                                                class="btn btn-danger btn-sm">Ê∏ÖÈô§</button>
                                            <button onclick="alarmSaveMusic()"
                                                class="btn btn-secondary btn-sm">‰øùÂ≠ò</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Music Composer -->
                        <div class="card card-wide" id="cardComposer">
                            <div class="card-header">
                                <h3>üéµ ÁºñÊõ≤Âô®</h3>
                                <span class="card-hint">8Èü≥Á¨¶Â∫èÂàó ¬∑ Ëá™ÂÆö‰πâÈü≥‰πê(ID:3)</span>
                            </div>
                            <div class="card-body">
                                <div class="composer-toolbar">
                                    <div class="form-group form-group-inline">
                                        <label class="form-label">BPM
                                            <span class="form-hint" title="ÊØèÂàÜÈíüËäÇÊãçÊï∞ÔºåÂΩ±ÂìçÈü≥Á¨¶Êó∂Èïø">‚ìò</span>
                                        </label>
                                        <input type="number" id="composerBpm" class="form-control form-control-sm"
                                            min="20" max="300" value="80" style="width:70px">
                                    </div>
                                    <div class="btn-group">
                                        <button onclick="composerClear()" class="btn btn-danger btn-sm">Ê∏ÖÁ©∫</button>
                                        <button onclick="composerUpload()" class="btn btn-warning btn-sm">‰∏ä‰º†</button>
                                        <button onclick="composerPlayAll()" class="btn btn-success btn-sm">
                                            ‚ñ∂ ‰∏ä‰º†Âπ∂Êí≠Êîæ
                                        </button>
                                    </div>
                                </div>

                                <!-- Note Grid -->
                                <div class="note-grid" id="noteGrid"></div>

                                <!-- Note Editor -->
                                <div class="note-editor">
                                    <div class="form-group form-group-mini">
                                        <label class="form-label">Èü≥Á¨¶#</label>
                                        <select id="editNoteIndex" class="form-control form-control-sm"
                                            onchange="loadNoteToEditor()">
                                            <option value="0">0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Èü≥È´ò</label>
                                        <select id="editNotePitch" class="form-control form-control-sm"
                                            onchange="onNoteEditorChange()">
                                            <!-- Áî± JavaScript Âä®ÊÄÅÂ°´ÂÖÖ -->
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">ËäÇÊãç</label>
                                        <select id="editNoteBeat" class="form-control form-control-sm"
                                            onchange="onNoteEditorChange()">
                                            <option value="47">1/16</option>
                                            <option value="94">1/8</option>
                                            <option value="188" selected>1/4</option>
                                            <option value="375">1/2</option>
                                            <option value="750">1</option>
                                            <option value="1500">2</option>
                                        </select>
                                    </div>
                                    <div class="btn-group">
                                        <button onclick="playNoteLocal()" class="btn btn-secondary btn-sm">üîä
                                            ËØïÂê¨</button>
                                        <button onclick="playAllLocal()" class="btn btn-success btn-sm">‚ñ∂ È¢ÑËßà</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Advanced Section (Terminal) - Hidden by default -->
                <section class="section section-advanced" id="sectionAdvanced" style="display:none;">
                    <div class="section-header">
                        <h2><span class="section-icon">üíª</span> Ë∞ÉËØïÁªàÁ´Ø</h2>
                        <div class="section-actions">
                            <button onclick="clearTerminal()" class="btn btn-danger btn-sm">Ê∏ÖÁ©∫</button>
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="terminal-wrapper">
                            <div id="terminal-container"></div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <span>DutyCycle Studio v1.0</span>
            <span class="footer-sep">|</span>
            <span>Web UI</span>
        </footer>
    </div>

    <!-- Device Settings Modal -->
    <div class="modal-overlay" id="deviceSettingsModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>ËÆæÂ§áËÆæÁΩÆ</h3>
                <button class="modal-close" onclick="closeDeviceSettings()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ËÆæÂ§áÂêçÁß∞</label>
                    <input type="text" id="deviceName" class="form-control" placeholder="ËæìÂÖ•ËÆæÂ§áÂêçÁß∞">
                </div>
                <div class="form-group">
                    <label class="form-label">ËÆæÂ§áID</label>
                    <input type="text" id="deviceIdDisplay" class="form-control" readonly disabled>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="deleteCurrentDevice()">Âà†Èô§ËÆæÂ§á</button>
                <button class="btn btn-secondary" onclick="closeDeviceSettings()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="saveDeviceSettings()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js?v=4"></script>
    <script>
        // Ë∞ÉËØïÔºöÊ£ÄÊü•ÂáΩÊï∞ÊòØÂê¶ÂÆö‰πâ
        window.addEventListener('load', function () {
            console.log('=== DutyCycle Debug ===');
            console.log('toggleConnect:', typeof toggleConnect);
            console.log('refreshPorts:', typeof refreshPorts);
            console.log('showDeviceSettings:', typeof showDeviceSettings);
            console.log('devices:', devices);
            console.log('activeDeviceId:', activeDeviceId);
            if (typeof toggleConnect !== 'function') {
                console.error('toggleConnect is not a function!');
            }
        });
    </script>
</body>

</html>